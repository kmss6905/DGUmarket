# 채팅방 유저 프로필 / 상품 클릭시 유효성 체크하기


**설명**

채팅방에서 상대방 프로필을 클릭 또는 상단의 상품이미지를 클릭하여 각각 내거래정보페이지 와 해당 상품의 상세정보페이지로 이동할 수 있는 구조이다. 하지만 만약 상대방이 관리자로 부터
제재를 당하거나 또는 유저가 스스로 탈퇴했을 경우에는 페이지는 불러오지만 데이터는 불러올 수 없는 구조이다. 이때 채팅하는 사용자의 경험으로는 굉장히 나쁘게 작용할 수 있다. 특히 모바일에서는 채팅메시지 중 어느 하나 프로필 이미지를 클릭하여 유저(제재당하거나 탈퇴)의 내거래정보 페이지에 가려고 한다면 이미 VIEW는 요청한 상태이며 채팅방은 화면에서 가려진 상태이다 하지만 제재당하거나 탈퇴당했기 때문에 어떠한 정보도 화면에 보여주지 않는다. 물건도 마찬가지

이런경우를 막고자 먼저 프로필이미지나 물건을 클릭했을 때(채팅방에 한하여)
서버로부터 유효성을 체크한다. 그리고 해당 유효성이 통과되었을 경우에만
그 이후에 VIEW를 요청하는 행위를 하게된다.

결론:
이미지나 물건을 클릭하여 해당 페이지로 이동하는 경우 먼저 유효성체크 API를 통해 이미지나 물건에 접근할 수 있는 지를 먼저 체크한다.

만약 접근하지 못할 경우 (그런 응답값을 받을 경우, 예시참조) 화면에 적절한 UI처리를 한다.

만약 접근가능(응답 : "ok") 의 응답 값을 받을 경우 이후의 view를 요청한다(이전처럼 늘 했듯이)

**수정 5 / 12**

아래의 에러 메시지 문구 변경 "차단한 유저의 정보에 접근할 수 없습니다. " => "나를 차단한 유저의 정보에 접근할 수 없습니다."

### 2.내가 상대방을 차단했을 경우(상품/프로필) - 확인

```json

{
  "statusCode": 403,
  "timestamp": "2021-03-26T00:44:55.532+00:00",
  "message": "나를 차단한 유저의 정보에 접근할 수 없습니다.",
  "requestPath": "uri=/api/chatroom/check-validate",
  "pathToMove": null
}


```
반드시 참고바랍니다.




--- 

**URL** : `/api/chatroom/check-validate`

**Request param(body)** : (자세한 건 아래 참조)

**Method** : `POST`

**Auth required** : YES


### request body(json)
두 가지 케이스가 있다.

1. 채팅방 상단의 물건을 클릭했을 경우

ex)

```json

{
  "product_id": "채팅방 상단의 물건 고유 번호"
}

```


2.채팅메시지 중 상대방 프로필을 클릭했을 경우

ex)

```json

{
  "user_id": "상대방 유저 고유 아이디"
}

```



### success response(string)

'ok'


---

제재의 종류 (경고 / 이용자제재 / 물건 블라인드)

추후 언제 제재를 해야하는 지에 대한 것은 추후 정리해서 알려드리겠습니다.(**추후**) -> 이 경우는 정확히 언제 유저에게 제재를 가할 것인지에 대한
규칙을 세부적으로 만들어야 하는 부분이다.


## **경고**
관리자가 유저에게 **경고**를 줍니다. 이때 경고는 말그대로 한 번 기회를 더 주는 것이며, 경고누적3회가 될 경우, 1주일간 경고패널티를 먹게됩니다.(**경고문구노출**)
경고누적 5회가 될 경우 **유저제재** 와 같은 효과를 지니는 패널티를 가지게 됩니다( 유저제재 된다고 생각하면 됨 )



## **유저제재**
관리자가 해당 유저에 대해서 **서비스사용중지** 처분을 내리는 것을 의미한다. 여기서 말하는 서비스 사용중지란 로그인 불가, 설사 로그인상태에 있더라도 어떠한 인증이 필요한 서비스는 전혀 이용하지 못하는 것을 의미한다.

제재 당한 유저의 물건 역시 다른 유저에게 보여지지 않으며 조회불가능하다.


## **비공개**
한마디로 물건을 일시적으로 보이지 않도록 하는 것입니다. 가령 불건전한 물건, 동국마켓에서 지정한 업로드금지품목, 또는 사회통념과 어긋나는 물건 등을 업로드 하였을 경우 관리자 재량으로 해당 물건을 보이지 않게 처리하는 것을 의미합니다.



## 예외 상항 response

(상품/프로필) 이렇게 쓰여져 있는 것은 상품 또는 프로필 이라는 의미입니다.
즉, 상품을 클릭한 결과 프로필을 클릭했을 때 나오는 응답값이 똑같다는 의미입니다.

만약 아래와 같은 응답결과를 받게 된다면 클라이언트는 적절한 유아이 화면으로 바꿔줘야 합니다!


### 1.탈퇴한유저일 경우(상품/프로필) - 확인

```json

{
    "statusCode": 404,
    "timestamp": "2021-03-10T13:05:47.217+00:00",
    "message": "탈퇴한 유저의 정보에 접근할 수 없습니다.",
    "description": "uri=/api/chatroom/check-validate",
    "pathToMove": null
}

```


### 2.내가 상대방을 차단했을 경우(상품/프로필) - 확인

```json

{
  "statusCode": 403,
  "timestamp": "2021-03-26T00:44:55.532+00:00",
  "message": "나를 차단한 유저의 정보에 접근할 수 없습니다.",
  "requestPath": "uri=/api/chatroom/check-validate",
  "pathToMove": null
}


```


### 3. 상대방으로 부터 차단당했을 경우(상품/프로필) - 확인

```json

{
  "statusCode": 403,
  "timestamp": "2021-03-26T00:44:31.269+00:00",
  "message": "차단당한 유저의 정보에 접근할 수 없습니다.",
  "requestPath": "uri=/api/chatroom/check-validate",
  "pathToMove": null
}

```


### 4.관리자로부터 이용제재 받고 있는 유저조회(상품/프로필) - 확인

```json

{
    "statusCode": 404,
    "timestamp": "2021-03-10T13:05:47.217+00:00",
    "message": "관리자에 의해 이용제재를 받고 있는 유저의 정보에 접근할 수 없습니다.",
    "description": "uri=/api/chatroom/check-validate",
    "pathToMove": null
}

```


### 5. 관리자에 의해 상품이 비공개 처리된경우(상품) - 확인

```json

{
    "statusCode": 404,
    "timestamp": "2021-03-10T12:46:52.623+00:00",
    "message": "해당 중고물품은 관리자에 의해 비공개 처리되었습니다.",
    "description": "uri=/api/chatroom/check-validate",
    "pathToMove": null
}



```


### 6. 물건이 삭제된경우(상품) 

```json

{
    "statusCode": 404,
    "timestamp": "2021-03-10T12:47:57.513+00:00",
    "message": "해당 중고물품은 판매자에 의해 삭제되었습니다.",
    "description": "uri=/api/chatroom/check-validate",
    "pathToMove": null
}

```