### 회원가입 2단계, 3단계 페이지 토큰 유효 검사 API 

**회원가입 2단계 페이지 이동**

우리 서비스에서 페이지 접근과 관련한 기준은 `인증여부`가 있었습니다. 예를 들어 인증이 필요한 페이지에는 토큰을 통해 유효성 검증을 통과해야 접근할 수 있었습니다. (예 - 상품 업로드 페이지, 회원 프로필 정보 조회 페이지 등)

회원가입 2단계 페이지는 인증이 필요 없습니다. 따라서 비회원 유저가 접근할 수 있습니다. 하지만 회원가입 절차 상 웹메일 인증을 마친 비회원 유저가 접근할 수 있으므로, 2단계 또는 3단계 페이지 이동 시 토큰을 검사해 유효성을 검사합니다. 검사 내용은 다음과 같고, 두 검증을 모두 통과한 경우에 2단계 페이지로 접근할 수 있습니다. 

- 유효한 링크를 통해 회원가입 2단계 페이지로 이동했는가?
- 이미 회원인 유저가 접근하지 않았는가? 

1. 링크 클릭 (클라이언트)
2. 2단계 페이지 반환 (서버)
3. 토큰 유효성 검사 API 요청 (클라이언트)
4. 반환 받은 페이지 활용 **또는** Alert 이후 메인 페이지 이동 

(참고) **회원가입 2단계 페이지에서 웹메일 정보는 어떻게 알 수 있죠?**

회원가입 2단계 페이지에는 웹메일에 전송된 링크를 통해 접근할 수 있습니다. 링크를 통해 2단계 페이지를 반환 받을 때 응답 헤더 `webMail` 키 값에 링크와 대응되는 웹메일 정보가 있습니다. 응답 헤더를 직접 눈으로 확인하시고 해당 값을 활용하시면 됩니다.

___

**회원가입 3단계 페이지 이동**

회원가입 3단계 페이지는 2단계 페이지에서 핸드폰 인증이 완료된 시점에 이동하게 됩니다. 서버로부터 3단계 페이지에 접근할 수 있는 Location(URL)을 응답 받고 해당 값을 활용해서 3단계 페이에 접근하게 됩니다. (Location.href 활용)

앞서 언급한 것처럼 핸드폰 인증이 완료된 시점에 3단계 페이지 주소 값을 반환 받으므로, 핸드폰 인증 API 문서를 확인하시면 자세한 스펙을 알 수 있습니다. 

3단계 페이지 역시 2단계 페이지 이동과 동일하게 토큰 값을 `쿼리 파람` 으로 받아서 서버 측에서 유효성 검사를 통과한 후에 페이지를 반환 받는 과정을 거치게 됩니다. 실제로 핸드폰 인증 API 응답 값 예시는 다음과 같습니다. 

```json
[HTTP/1.1 200 OK]
// 핸드폰 인증 성공 
{
    "statusCode": 2,
    "message": "핸드폰 인증 성공",
    "responseData": "회원가입 3단계 페이지 요청 URL" 
    
  	// URL 예시 
    // http://localhost:8081/shop/account/userInfo_input?user_id=토큰값
}
```

___

**URL** : `/api/filter/pre-member/verify-token`  

**Method** : `POST`

**Authentication** : 인증 필요 X  

**Custom Header** : 

```
// Custom Header 'user_id' 키 값에 토큰 값을 넣어서 요청해주시면 됩니다. 
"user_id" : "토큰 값"
```

**Request Body** : X

```json
// 페이지 접근 가능한 경우 
// 기존 반환 받은 페이지를 활용해서 회원가입을 진행할 수 있다. 
[HTTP/1.1 200 OK]
{
    "timestamp": "2021-03-23T13:41:04.254+00:00",
    "path": "/api/filter/pre-member/verify-token",
    "status": 200,
    "message": "회원가입 2 또는 3 페이지 접근 가능"
}



// 페이지 접근이 불가능한 경우 
// Alert -> 메인 페이지 요청 
[HTTP/1.1 200 OK]
{
    "timestamp": "2021-03-23T13:44:30.067+00:00",
    "path": "/api/filter/pre-member/verify-token",
    "status": 302,
    "message": "토큰이 유효하지 않은 경우 (DB 토큰과 값이 다른 경우) + JWT MalformedException",
    "pathToMove": "/shop/main/index"
}
[HTTP/1.1 200 OK]
{
    "timestamp": "2021-03-23T13:42:50.269+00:00",
    "path": "/api/filter/pre-member/verify-token",
    "status": 302,
    "message": "회원가입 2 또는 3 페이지 토큰 값 없는 상태 접근",
    "pathToMove": "/shop/main/index"
}

[HTTP/1.1 200 OK]
{
    "timestamp": "2021-03-23T13:39:40.582+00:00",
    "path": "/api/filter/pre-member/verify-token",
    "status": 302,
    "message": "해당 웹메일로 회원가입이 불가능한 경우",
    "pathToMove": "/shop/main/index"
}
```

____





