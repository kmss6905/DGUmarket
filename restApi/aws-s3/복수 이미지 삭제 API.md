## **복수 이미지 삭제 API** (인증)



복수 이미지 삭제 API는 AWS S3를 이용한 복수의 이미지 삭제  처리해주는 API 입니다.

우리 서비스에서 **복수 이미지 삭제 API**를 요청하는 경우는 다음과 같습니다.

- **상품 수정**

*(<u>참고</u>) 상품 삭제할 때는 왜 복수 이미지 삭제 API를 요청하지 않죠? (예상 질문)*

상품 삭제 API에서 복수 이미지 삭제 API를 요청하지 않는 이유는, 상품 삭제 요청을 통해서 실제 데이터베이스에 있는 상품의 정보를 삭제하는 것이 아니라, 상품의 상태 값만 변경하기 때문입니다. 실제 상품 데이터가 삭제되는 시점은 해당 상품을 업로드한 유저의 정보가 탈퇴 이후 삭제될 때 입니다. 상품과 관련한 이미지 역시 이 때 삭제되므로 상품 삭제 API에서는 복수 이미지 삭제 API를 따로 요청하지 않습니다. 

___

상품 수정 시 어떤 경우에 복수 이미지 삭제 API를 요청하게 될까요?

- 기존 이미지가 N장이 있었고, 상품 수정 과정에서 모든 이미지를 지우는 경우

예) 

기존 이미지가 5장 있었지만, 상품 수정 과정에서 0장으로 수정하는 경우

____

(<u>참고</u>) 

*기존 이미지가 5장이 있고, 수정할 때 2장으로 수정하는 경우는 왜 복수 이미지 삭제 API를 요청하지 않나요? (예상 질문)*

실제로 위 경우에도 AWS S3에 이미지 삭제 요청을 보내는 처리를 하지만, 위 경우에는 최종적으로 업로드하는 2장의 사진에 대해서는 업로드 처리를 하고, 나머지  기존 5장에서 3장의 사진만 삭제 요청을 보내는 경우입니다. 따라서 이미지 삭제 API만을 요청하지 않기 때문에 (이미지 업로드 & 삭제) 로직을 모두 포함하고 있는 API에서 따로 처리합니다.

___

**요청 예시**

```json
기존 이미지가 N장에서 수정하면서 모든 이미지를 삭제하는 경우 
 
// form-data 
 
 // 복수 이미지 삭제 API 역시 상품 수정에서만 해당 하므로, 삭제할 경로(Prefix)는 아래와 같습니다. 
[필수] "uploadDirPrefix" : "origin/product/"

// 삭제할 파일명 리스트
[필수] "prevFileNames" : ["example.jpg", "example2.jpg", "example3.jpg"] 

```



**응답 예시**

```json
[HTTP/1.1 200]
{
    "statusCode": 200,
    "message": "AWS 복수 이미지 삭제 성공",
    "responseData": null 
    // responseData 값(=null)을 활용해서 상품 수정 시 이미지 저장 경로 값으로 활용하면 됩니다.
}

// 아래는 복수 이미지 사진 삭제 API 처리 과정 중 에러가 발생한 경우입니다.

// 353 : AmazonServiceException, 복수 이미지 사진 삭제 API

// 위 statusCode 응답 시, "요청하신 작업을 수행하지 못했습니다. 일시적인 현상이니 잠시 후 다시 시도해주세요. (오류코드 : statusCode)" Alert 띄어주고 해당 페이지(상품 업로드 페이지)에 그대로 유지 해주시면 됩니다. 

[HTTP/1.1 200]
{
    "statusCode": 353,
    "timestamp": "2021-03-29T01:08:27.438+00:00",
    "message": "AmazonServiceException, 복수 이미지 사진 삭제 API",
    "requestPath": "/api/multi-img/delete",
    "pathToMove": null
}

```